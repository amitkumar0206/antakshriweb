<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="antakshri.css">
</head>
<body>

<div class="header">
    <div class="title">
        <h1 th:text="${message}"></h1>
    </div>
</div>

<div class="container">
    <div class="teams-container">
        <div class="team-box">
            <div class="team-logo">
                <img src="team1-logo.png" alt="Team 1 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Deewane</div>
                <div class="team-score">100</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team2-logo.png" alt="Team 2 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Parwaane</div>
                <div class="team-score">400</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team3-logo.png" alt="Team 3 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Mastaane</div>
                <div class="team-score">400</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team4-logo.png" alt="Team 4 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Afsaane</div>
                <div class="team-score">350</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team5-logo.png" alt="Team 5 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Taraane</div>
                <div class="team-score">100</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team6-logo.png" alt="Team 6 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Anjaane</div>
                <div class="team-score">100</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team7-logo.png" alt="Team 7 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Suhaane</div>
                <div class="team-score">100</div>
            </div>
        </div>
        <div class="team-box">
            <div class="team-logo">
                <img src="team8-logo.png" alt="Team 8 Logo">
            </div>
            <div class="team-info">
                <div class="team-name">Sayaane</div>
                <div class="team-score">100</div>
            </div>
        </div>
    </div>
</div>

<div class="buzzers-wrapper">
    <div class="logo-box">
        <div class="images-container">
            <div class="logo">
                <img src="logo.png" alt="Logo">
            </div>
        </div>
    </div>
    <div class="buzzers-box">
        <div class="buzzers-boxes">
            <div class="buzzers-header">BUZZERS</div>
            <div class="buzzer-lists">
                <div class="buzzer-list" id="buzzer-list-player">
                    <div class="buzzer-list-header">PLAYERS</div>
                    <div class="buzzer-list-title">Top 5 Buzzers by Players</div>
                    <!-- Buzzer items will be appended here -->
                </div>
                <div class="buzzer-list" id="buzzer-list-audience">
                    <div class="buzzer-list-header">AUDIENCE</div>
                    <div class="buzzer-list-title">Top 5 Buzzers by Audience</div>
                    <!-- Buzzer items will be appended here -->
                </div>
            </div>
        </div>
    </div>
    <div class="qr-code-box">
        <div class="images-container">
            <div class="qr-code">
                <img src="qrcode.png" alt="QR Code">
            </div>
        </div>
    </div>
</div>

</body>
</html>
<script>
    async function fetchBuzzers() {
        try {
            const response = await fetch('http://localhost:8080/buzzers');
            const buzzers = await response.json();

            const buzzerListPlayer = document.getElementById('buzzer-list-player');
            const buzzerListAudience = document.getElementById('buzzer-list-audience');
            buzzerListPlayer.innerHTML = ''; // Clear the list
            buzzerListAudience.innerHTML = ''; // Clear the list

            // Append headers
            const playerHeader = document.createElement('div');
            playerHeader.className = 'buzzer-list-header';
            playerHeader.innerText = 'PLAYERS';
            buzzerListPlayer.appendChild(playerHeader);

            const audienceHeader = document.createElement('div');
            audienceHeader.className = 'buzzer-list-header';
            audienceHeader.innerText = 'AUDIENCE';
            buzzerListAudience.appendChild(audienceHeader);

            // Check and append buzzers for players
            if (Object.keys(buzzers["PLAYER"]).length === 0) {
                const noBuzzersMessage = document.createElement('div');
                noBuzzersMessage.className = 'no-buzzers-message';
                noBuzzersMessage.innerText = 'Incoming Buzzers';
                buzzerListPlayer.appendChild(noBuzzersMessage);
            } else {
                Object.keys(buzzers["PLAYER"]).slice(0, 5).forEach((key, index) => {
                    const buzzerItem = document.createElement('div');
                    buzzerItem.className = 'buzzer-item';
                    buzzerItem.innerHTML = `
                    <div class="sequence-box" style="background-color: ${getUniqueColor(index)};">${key}</div>
                    <div class="details-box">
                        <div class="team-name">${buzzers["PLAYER"][key].teamName}</div>
                        <div class="player-name">${buzzers["PLAYER"][key].personName}</div>
                    </div>
                `;
                    buzzerListPlayer.appendChild(buzzerItem);
                });
            }

            // Check and append buzzers for audience
            if (Object.keys(buzzers["AUDIENCE"]).length === 0) {
                const noBuzzersMessage = document.createElement('div');
                noBuzzersMessage.className = 'no-buzzers-message';
                noBuzzersMessage.innerText = 'Incoming Buzzers';
                buzzerListAudience.appendChild(noBuzzersMessage);
            } else {
                Object.keys(buzzers["AUDIENCE"]).slice(0, 5).forEach((key, index) => {
                    const buzzerItem = document.createElement('div');
                    buzzerItem.className = 'buzzer-item';
                    buzzerItem.innerHTML = `
                    <div class="sequence-box" style="background-color: ${getUniqueColor(index)};">${key}</div>
                    <div class="details-box">
                        <div class="team-name">${buzzers["AUDIENCE"][key].teamName}</div>
                        <div class="player-name">${buzzers["AUDIENCE"][key].personName}</div>
                    </div>
                `;
                    buzzerListAudience.appendChild(buzzerItem);
                });
            }
        } catch (error) {
            console.error('Error fetching buzzers:', error);
        }
    }

    function getUniqueColor(index) {
        const colors = ['#ffcc80', '#80d8ff', '#ff8a80', '#ccff90', '#d1c4e9'];
        return colors[index % colors.length];
    }

    // Fetch buzzers every 1 second
    setInterval(fetchBuzzers, 1000);

    async function fetchScores() {
        try {
            const response = await fetch('http://localhost:8080/scores');
            const scores = await response.json();

            for (const [team, score] of Object.entries(scores)) {
                const teamElement = document.querySelector(`.team-name:contains(${team})`);
                if (teamElement) {
                    const scoreElement = teamElement.nextElementSibling;
                    if (scoreElement) {
                        scoreElement.innerText = score;
                    }
                }
            }
        } catch (error) {
            console.error('Error fetching scores:', error);
        }
    }

    // Fetch scores every 2 seconds
    setInterval(fetchScores, 2000);
</script>